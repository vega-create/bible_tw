---
// ä»Šæ—¥ç¶“æ–‡å·¥å…· - ä¸²æ¥è–ç¶“ JSON
import BaseLayout from '../../layouts/BaseLayout.astro';
import bibleData from '../../data/zh_cuv.json';

// æ›¸å·ä¸­æ–‡åç¨±å°ç…§
const bookNames: Record<string, string> = {
  gn: "å‰µä¸–è¨˜", ex: "å‡ºåŸƒåŠè¨˜", lv: "åˆ©æœªè¨˜", nm: "æ°‘æ•¸è¨˜", dt: "ç”³å‘½è¨˜",
  js: "ç´„æ›¸äºè¨˜", jd: "å£«å¸«è¨˜", rt: "è·¯å¾—è¨˜", "1sm": "æ’’æ¯è€³è¨˜ä¸Š", "2sm": "æ’’æ¯è€³è¨˜ä¸‹",
  "1kgs": "åˆ—ç‹ç´€ä¸Š", "2kgs": "åˆ—ç‹ç´€ä¸‹", "1ch": "æ­·ä»£å¿—ä¸Š", "2ch": "æ­·ä»£å¿—ä¸‹",
  ezr: "ä»¥æ–¯æ‹‰è¨˜", ne: "å°¼å¸Œç±³è¨˜", et: "ä»¥æ–¯å¸–è¨˜", job: "ç´„ä¼¯è¨˜", ps: "è©©ç¯‡",
  prv: "ç®´è¨€", ec: "å‚³é“æ›¸", so: "é›…æ­Œ", is: "ä»¥è³½äºæ›¸", jr: "è€¶åˆ©ç±³æ›¸",
  lm: "è€¶åˆ©ç±³å“€æ­Œ", ez: "ä»¥è¥¿çµæ›¸", dn: "ä½†ä»¥ç†æ›¸", hs: "ä½•è¥¿é˜¿æ›¸", jl: "ç´„ç¥æ›¸",
  am: "é˜¿æ‘©å¸æ›¸", ob: "ä¿„å·´åº•äºæ›¸", jn: "ç´„æ‹¿æ›¸", mc: "å½Œè¿¦æ›¸", na: "é‚£é´»æ›¸",
  hk: "å“ˆå·´è°·æ›¸", zp: "è¥¿ç•ªé›…æ›¸", hg: "å“ˆè©²æ›¸", zc: "æ’’è¿¦åˆ©äºæ›¸", ml: "ç‘ªæ‹‰åŸºæ›¸",
  mt: "é¦¬å¤ªç¦éŸ³", mk: "é¦¬å¯ç¦éŸ³", lk: "è·¯åŠ ç¦éŸ³", jo: "ç´„ç¿°ç¦éŸ³", act: "ä½¿å¾’è¡Œå‚³",
  rm: "ç¾…é¦¬æ›¸", "1co": "å“¥æ—å¤šå‰æ›¸", "2co": "å“¥æ—å¤šå¾Œæ›¸", gl: "åŠ æ‹‰å¤ªæ›¸", eph: "ä»¥å¼—æ‰€æ›¸",
  ph: "è…“ç«‹æ¯”æ›¸", cl: "æ­Œç¾…è¥¿æ›¸", "1ts": "å¸–æ’’ç¾…å°¼è¿¦å‰æ›¸", "2ts": "å¸–æ’’ç¾…å°¼è¿¦å¾Œæ›¸",
  "1tm": "ææ‘©å¤ªå‰æ›¸", "2tm": "ææ‘©å¤ªå¾Œæ›¸", tt: "æå¤šæ›¸", phm: "è…“åˆ©é–€æ›¸",
  hb: "å¸Œä¼¯ä¾†æ›¸", jm: "é›…å„æ›¸", "1pe": "å½¼å¾—å‰æ›¸", "2pe": "å½¼å¾—å¾Œæ›¸",
  "1jo": "ç´„ç¿°ä¸€æ›¸", "2jo": "ç´„ç¿°äºŒæ›¸", "3jo": "ç´„ç¿°ä¸‰æ›¸", jd2: "çŒ¶å¤§æ›¸", re: "å•Ÿç¤ºéŒ„",
};

// ç²¾é¸ç¶“æ–‡ç´¢å¼•ï¼ˆé©åˆç•¶æ¯æ—¥ç¶“æ–‡çš„ï¼‰
const featuredVerses = [
  { book: "ps", chapter: 23, verse: 1 },
  { book: "ps", chapter: 23, verse: 4 },
  { book: "ps", chapter: 46, verse: 1 },
  { book: "ps", chapter: 91, verse: 1 },
  { book: "ps", chapter: 119, verse: 105 },
  { book: "ps", chapter: 121, verse: 1 },
  { book: "prv", chapter: 3, verse: 5 },
  { book: "prv", chapter: 3, verse: 6 },
  { book: "is", chapter: 40, verse: 31 },
  { book: "is", chapter: 41, verse: 10 },
  { book: "jr", chapter: 29, verse: 11 },
  { book: "jr", chapter: 31, verse: 3 },
  { book: "mt", chapter: 6, verse: 33 },
  { book: "mt", chapter: 7, verse: 7 },
  { book: "mt", chapter: 11, verse: 28 },
  { book: "jo", chapter: 3, verse: 16 },
  { book: "jo", chapter: 14, verse: 6 },
  { book: "jo", chapter: 14, verse: 27 },
  { book: "rm", chapter: 8, verse: 28 },
  { book: "rm", chapter: 8, verse: 38 },
  { book: "ph", chapter: 4, verse: 6 },
  { book: "ph", chapter: 4, verse: 13 },
  { book: "hb", chapter: 11, verse: 1 },
  { book: "hb", chapter: 13, verse: 8 },
  { book: "jm", chapter: 1, verse: 5 },
  { book: "1pe", chapter: 5, verse: 7 },
  { book: "1jo", chapter: 4, verse: 8 },
];

// æº–å‚™ç¶“æ–‡è³‡æ–™å‚³çµ¦å‰ç«¯
const versesForClient = featuredVerses.map(v => {
  const bookData = bibleData.find((b: any) => b.abbrev === v.book);
  if (!bookData) return null;
  
  const verseText = bookData.chapters[v.chapter - 1]?.[v.verse - 1];
  if (!verseText) return null;
  
  const bookName = bookNames[v.book] || bookData.book;
  return {
    text: verseText,
    ref: `${bookName} ${v.chapter}:${v.verse}`,
  };
}).filter(Boolean);
---

<BaseLayout 
  title="ä»Šæ—¥ç¶“æ–‡"
  description="æ¯å¤©ä¸€ç¯€ç¶“æ–‡ï¼Œè†è½ç¥å°ä½ èªªçš„è©±"
>
  <div class="max-w-2xl mx-auto px-4 py-16">
    <div class="text-center mb-12">
      <h1 class="text-3xl font-bold text-gray-800 mb-4">âœ¨ ä»Šæ—¥ç¶“æ–‡</h1>
      <p class="text-gray-600">é»æ“Šä¸‹æ–¹æŒ‰éˆ•ï¼Œçœ‹çœ‹ä»Šå¤©ç¥è¦å°ä½ èªªä»€éº¼</p>
    </div>
    
    <!-- ç¶“æ–‡é¡¯ç¤ºå€ -->
    <div id="verse-container" class="bg-white rounded-2xl shadow-lg p-8 mb-8 min-h-[200px] flex items-center justify-center">
      <div id="verse-content" class="text-center">
        <p class="text-gray-400">é»æ“ŠæŒ‰éˆ•ç²å–ä»Šæ—¥ç¶“æ–‡</p>
      </div>
    </div>
    
    <!-- æŒ‰éˆ•å€ -->
    <div class="flex flex-col items-center space-y-4">
      <button 
        id="get-verse-btn"
        class="px-8 py-4 bg-primary text-white text-lg font-semibold rounded-full hover:bg-opacity-90 transition-all shadow-lg hover:shadow-xl"
      >
        ğŸ¯ ä»Šå¤©ç¥è¦å°æˆ‘èªªä»€éº¼ï¼Ÿ
      </button>
      
      <div id="share-buttons" class="hidden flex space-x-4 mt-4">
        <button id="copy-btn" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">
          ğŸ“‹ è¤‡è£½ç¶“æ–‡
        </button>
        <button id="share-btn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
          ğŸ”— åˆ†äº«
        </button>
      </div>
    </div>
    
    <!-- å†æŠ½ä¸€æ¬¡ -->
    <div class="text-center mt-8">
      <button 
        id="another-btn"
        class="hidden text-primary hover:underline"
      >
        ğŸ”„ å†æŠ½ä¸€ç¯€
      </button>
    </div>
  </div>
</BaseLayout>

<script define:vars={{ versesForClient }}>
  const verses = versesForClient;
  let currentVerse = null;
  
  function getRandomVerse() {
    const randomIndex = Math.floor(Math.random() * verses.length);
    return verses[randomIndex];
  }
  
  function displayVerse(verse) {
    const container = document.getElementById('verse-content');
    container.innerHTML = `
      <blockquote class="text-xl md:text-2xl text-gray-700 mb-4 leading-relaxed font-serif">
        ã€Œ${verse.text}ã€
      </blockquote>
      <p class="text-primary font-medium">â€” ${verse.ref}</p>
    `;
    document.getElementById('share-buttons').classList.remove('hidden');
    document.getElementById('another-btn').classList.remove('hidden');
    currentVerse = verse;
  }
  
  document.getElementById('get-verse-btn').addEventListener('click', () => {
    const verse = getRandomVerse();
    displayVerse(verse);
  });
  
  document.getElementById('another-btn').addEventListener('click', () => {
    const verse = getRandomVerse();
    displayVerse(verse);
  });
  
  document.getElementById('copy-btn').addEventListener('click', () => {
    if (currentVerse) {
      const text = `ã€Œ${currentVerse.text}ã€â€” ${currentVerse.ref}`;
      navigator.clipboard.writeText(text);
      alert('ç¶“æ–‡å·²è¤‡è£½ï¼');
    }
  });
  
  document.getElementById('share-btn').addEventListener('click', () => {
    if (currentVerse && navigator.share) {
      navigator.share({
        title: 'ä»Šæ—¥ç¶“æ–‡',
        text: `ã€Œ${currentVerse.text}ã€â€” ${currentVerse.ref}`,
        url: window.location.href,
      });
    } else if (currentVerse) {
      const text = encodeURIComponent(`ã€Œ${currentVerse.text}ã€â€” ${currentVerse.ref}`);
      window.open(`https://www.facebook.com/sharer/sharer.php?quote=${text}`, '_blank');
    }
  });
</script>